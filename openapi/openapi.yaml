openapi: 3.0.3
info:
  title: TeamDevelop Bravo API
  description: 勤怠管理システムの REST API ドキュメント
  version: v1
  contact:
    name: TeamDevelop SRE
    email: sre@example.com
  license:
    name: Apache License Version 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0
servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.teamdevelop.example.com
    description: Production server
tags:
  - name: Auth
    description: 認証/セッション API
  - name: Employees
    description: 従業員管理 API
  - name: Home
    description: ホーム ダッシュボード/打刻 API
  - name: Stamp History
    description: 打刻履歴 API
  - name: Stamp Request Workflow
    description: 打刻修正申請ワークフロー API
  - name: News Management
    description: お知らせ管理 API
  - name: Profile
    description: プロフィール API
paths:
  /api/auth/login:
    post:
      tags:
        - Auth
      summary: ログイン
      description: メールとパスワードでログインし、セッションを開始します
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: 認証失敗
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: ログアウト
      description: セッションを終了します
      operationId: logout
      responses:
        '204':
          description: ログアウト成功
  /api/auth/session:
    get:
      tags:
        - Auth
      summary: セッション状態取得
      description: 現在の認証状態と従業員概要を返します
      operationId: getSession
      responses:
        '200':
          description: セッション情報
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
  /api/employees:
    get:
      tags:
        - Employees
      summary: 従業員一覧
      description: 管理者のみ絞り込み可能（adminOnly=true）
      operationId: listEmployees
      parameters:
        - name: adminOnly
          in: query
          description: 管理者のみ表示
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: 従業員一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeListResponse'
    post:
      tags:
        - Employees
      summary: 従業員作成
      description: 新規ユーザーを作成（ADMIN権限が必要）
      operationId: createEmployee
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeUpsertRequest'
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeSummaryResponse'
        '400':
          description: リクエストエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: メールアドレス重複
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - Employees
      summary: 従業員削除
      description: 複数IDに対応（ADMIN権限が必要）
      operationId: deleteEmployees
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeDeleteRequest'
      responses:
        '204':
          description: 削除成功
  /api/employees/{employeeId}:
    put:
      tags:
        - Employees
      summary: 従業員更新
      description: 既存ユーザーを更新（ADMIN権限が必要）
      operationId: updateEmployee
      security:
        - sessionAuth: []
      parameters:
        - name: employeeId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeUpsertRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeSummaryResponse'
        '404':
          description: 従業員が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: メールアドレス重複
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/home/overview:
    get:
      tags:
        - Home
      summary: ホーム概要
      description: ログイン中の従業員情報とお知らせ一覧を返却
      operationId: getHomeOverview
      security:
        - sessionAuth: []
      responses:
        '200':
          description: ホーム画面情報
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomeDashboardResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/home/stamps:
    post:
      tags:
        - Home
      summary: 打刻
      description: 出勤/退勤の打刻を記録
      operationId: stamp
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequest'
      responses:
        '200':
          description: 打刻成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/home/breaks/toggle:
    post:
      tags:
        - Home
      summary: 休憩トグル
      description: 休憩開始/終了を切り替えます
      operationId: toggleBreak
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BreakToggleRequest'
      responses:
        '204':
          description: トグル成功
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 休憩開始/終了が既に登録されている場合のエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicateBreakToggle:
                  summary: 重複する休憩操作
                  value:
                    message: "休憩操作は既に登録されています。画面を再読み込みして最新の勤怠状況を確認してください。"
  /api/stamp-history:
    get:
      tags:
        - Stamp History
      summary: 打刻履歴取得
      description: 年・月の指定がなければ当月を返却
      operationId: getStampHistory
      security:
        - sessionAuth: []
      parameters:
        - name: year
          in: query
          description: 年（YYYY形式）
          required: false
          schema:
            type: string
        - name: month
          in: query
          description: 月（MM形式）
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 打刻履歴
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampHistoryResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamps/{id}:
    put:
      tags:
        - Stamp
      summary: 打刻履歴更新
      description: 指定した打刻IDの出勤/退勤時刻を更新
      operationId: updateStamp
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampUpdateRequest'
      responses:
        '204':
          description: 更新成功
        '400':
          description: 入力値が不正です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 対象の打刻が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - Stamp
      summary: 打刻履歴削除
      description: 指定した打刻IDを削除
      operationId: deleteStamp
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: 削除成功
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 対象の打刻が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/news:
    get:
      tags:
        - News Management
      summary: お知らせ一覧取得
      description: すべてのお知らせを日付降順で取得（管理者向け）
      operationId: getAllNews
      security:
        - sessionAuth: []
      responses:
        '200':
          description: お知らせ一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsListResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - News Management
      summary: お知らせ作成
      description: 新規お知らせを作成（ADMIN権限が必要）
      operationId: createNews
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsCreateRequest'
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/news/published:
    get:
      tags:
        - News Management
      summary: 公開お知らせ一覧取得
      description: 公開フラグがtrueのお知らせを日付降順で取得（認証不要）
      operationId: getPublishedNews
      responses:
        '200':
          description: 公開お知らせ一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsListResponse'
  /api/news/{id}:
    put:
      tags:
        - News Management
      summary: お知らせ更新
      description: 既存お知らせを更新（ADMIN権限が必要）
      operationId: updateNews
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsUpdateRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: お知らせが見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - News Management
      summary: お知らせ削除
      description: 指定IDのお知らせを削除（ADMIN権限が必要）
      operationId: deleteNews
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: 削除成功
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: お知らせが見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/news/{id}/publish:
    patch:
      tags:
        - News Management
      summary: お知らせ公開状態設定
      description: 公開/非公開フラグを明示的に設定（ADMIN権限が必要）
      operationId: toggleNewsPublish
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsPublishRequest'
      responses:
        '204':
          description: 設定成功
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: お知らせが見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/profile/me/statistics:
    get:
      tags:
        - Profile
      summary: 自身の勤怠統計取得
      description: ログイン中の従業員について、直近6か月の勤怠統計サマリと月次詳細を返します。
      operationId: getSelfProfileStatistics
      security:
        - sessionAuth: []
      responses:
        '200':
          description: 勤怠統計取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileStatisticsResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: メールアドレス
        password:
          type: string
          format: password
          description: パスワード
    LoginResponse:
      type: object
      required:
        - employee
      properties:
        employee:
          $ref: '#/components/schemas/EmployeeSummaryResponse'
    SessionResponse:
      type: object
      required:
        - authenticated
      properties:
        authenticated:
          type: boolean
          description: 認証状態
        employee:
          $ref: '#/components/schemas/EmployeeSummaryResponse'
          nullable: true
    EmployeeSummaryResponse:
      type: object
      required:
        - id
        - firstName
        - lastName
        - email
        - admin
      properties:
        id:
          type: integer
          description: 従業員ID
        firstName:
          type: string
          description: 名
        lastName:
          type: string
          description: 姓
        email:
          type: string
          format: email
          description: メールアドレス
        admin:
          type: boolean
          description: 管理者フラグ
    EmployeeListResponse:
      type: object
      required:
        - employees
      properties:
        employees:
          type: array
          items:
            $ref: '#/components/schemas/EmployeeSummaryResponse'
    EmployeeUpsertRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
        - admin
      properties:
        firstName:
          type: string
          description: 名
        lastName:
          type: string
          description: 姓
        email:
          type: string
          format: email
          description: メールアドレス
        password:
          type: string
          format: password
          description: パスワード（新規作成時必須）
          nullable: true
        admin:
          type: boolean
          description: 管理者フラグ
    EmployeeDeleteRequest:
      type: object
      required:
        - ids
      properties:
        ids:
          type: array
          items:
            type: integer
          description: 削除対象の従業員IDリスト
    HomeDashboardResponse:
      type: object
      required:
        - employee
        - news
      properties:
        employee:
          $ref: '#/components/schemas/EmployeeSummaryResponse'
        news:
          type: array
          items:
            $ref: '#/components/schemas/HomeNewsItem'
        attendance:
          $ref: '#/components/schemas/DailyAttendanceSnapshot'
          nullable: true
    HomeNewsItem:
      type: object
      required:
        - id
        - title
        - content
        - label
        - newsDate
        - releaseFlag
      properties:
        id:
          type: integer
          description: お知らせID
        title:
          type: string
          maxLength: 100
          description: お知らせタイトル
        content:
          type: string
          description: お知らせ内容
        label:
          type: string
          enum:
            - IMPORTANT
            - SYSTEM
            - GENERAL
          description: お知らせラベル
        newsDate:
          type: string
          format: date
          description: お知らせ日付（YYYY-MM-DD形式）
        releaseFlag:
          type: boolean
          description: 公開フラグ
    DailyAttendanceSnapshot:
      type: object
      required:
        - status
        - overtimeMinutes
      properties:
        status:
          $ref: '#/components/schemas/AttendanceStatus'
        attendanceTime:
          type: string
          format: date-time
          nullable: true
          description: 出勤時刻（ISO 8601、JST）
        breakStartTime:
          type: string
          format: date-time
          nullable: true
          description: 休憩開始時刻（ISO 8601、JST）
        breakEndTime:
          type: string
          format: date-time
          nullable: true
          description: 休憩終了時刻（ISO 8601、JST）
        departureTime:
          type: string
          format: date-time
          nullable: true
          description: 退勤時刻（ISO 8601、JST）
        overtimeMinutes:
          type: integer
          format: int32
          description: 残業時間（分）
    AttendanceStatus:
      type: string
      description: 勤務ステータス
      enum:
        - NOT_ATTENDED
        - WORKING
        - ON_BREAK
        - FINISHED
    NewsResponse:
      type: object
      required:
        - id
        - newsDate
        - title
        - content
        - label
        - releaseFlag
      properties:
        id:
          type: integer
          description: お知らせID
        newsDate:
          type: string
          format: date
          description: お知らせ日付（YYYY-MM-DD形式）
          example: "2025-10-15"
        title:
          type: string
          maxLength: 100
          description: お知らせタイトル
        content:
          type: string
          maxLength: 1000
          description: お知らせ内容（最大1000文字）
        label:
          type: string
          enum:
            - IMPORTANT
            - SYSTEM
            - GENERAL
          description: お知らせラベル
        releaseFlag:
          type: boolean
          description: 公開フラグ（true:公開, false:非公開）
        updateDate:
          type: string
          format: date-time
          description: 更新日時（ISO 8601形式）
          example: "2025-10-15T12:34:56Z"
    NewsListResponse:
      type: object
      required:
        - news
      properties:
        news:
          type: array
          items:
            $ref: '#/components/schemas/NewsResponse'
          description: お知らせリスト
    NewsCreateRequest:
      type: object
      required:
        - newsDate
        - title
        - content
        - releaseFlag
      properties:
        newsDate:
          type: string
          format: date
          description: お知らせ日付（YYYY-MM-DD形式）
          example: "2025-10-15"
        title:
          type: string
          minLength: 1
          maxLength: 100
          description: お知らせタイトル（1-100文字）
        content:
          type: string
          minLength: 1
          maxLength: 1000
          description: お知らせ内容（1-1000文字）
        label:
          type: string
          enum:
            - IMPORTANT
            - SYSTEM
            - GENERAL
          description: お知らせラベル（未指定の場合はGENERALを適用）
        releaseFlag:
          type: boolean
          description: "公開フラグ（true: 公開, false: 下書き）"
          example: true
    NewsUpdateRequest:
      type: object
      required:
        - newsDate
        - title
        - content
        - releaseFlag
      properties:
        newsDate:
          type: string
          format: date
          description: お知らせ日付（YYYY-MM-DD形式）
          example: "2025-10-15"
        title:
          type: string
          minLength: 1
          maxLength: 100
          description: お知らせタイトル（1-100文字）
        content:
          type: string
          minLength: 1
          maxLength: 1000
          description: お知らせ内容（1-1000文字）
        label:
          type: string
          enum:
            - IMPORTANT
            - SYSTEM
            - GENERAL
          description: お知らせラベル（未指定の場合はGENERALを適用）
        releaseFlag:
          type: boolean
          description: "公開フラグ（true: 公開, false: 下書き）"
          example: true
    NewsPublishRequest:
      type: object
      required:
        - releaseFlag
      properties:
        releaseFlag:
          type: boolean
          description: "公開フラグ（true: 公開, false: 非公開）"
          example: true
    ProfileStatisticsResponse:
      type: object
      required:
        - summary
        - monthly
      properties:
        summary:
          $ref: '#/components/schemas/AttendanceSummaryResponse'
        monthly:
          type: array
          items:
            $ref: '#/components/schemas/MonthlyAttendanceResponse'
          description: 過去6か月分の月次勤怠データ
    AttendanceSummaryResponse:
      type: object
      required:
        - currentMonth
        - trendData
      properties:
        currentMonth:
          $ref: '#/components/schemas/AttendanceSummaryCurrentMonth'
        trendData:
          type: array
          items:
            $ref: '#/components/schemas/AttendanceSummaryTrendItem'
          description: 直近6か月の勤怠トレンド
    AttendanceSummaryCurrentMonth:
      type: object
      required:
        - totalHours
        - overtimeHours
        - lateCount
        - paidLeaveHours
      properties:
        totalHours:
          type: number
          format: double
          description: 月間総労働時間（時間）
          example: 168.5
        overtimeHours:
          type: number
          format: double
          description: 月間残業時間（時間）
          example: 12
        lateCount:
          type: integer
          format: int32
          description: 月間の遅刻回数
          example: 1
        paidLeaveHours:
          type: number
          format: double
          description: 有給消化時間（時間）
          example: 8
    AttendanceSummaryTrendItem:
      type: object
      required:
        - month
        - totalHours
        - overtimeHours
      properties:
        month:
          type: string
          description: 月（YYYY-MM形式）
          example: "2025-10"
        totalHours:
          type: number
          format: double
          description: 月間総労働時間（時間）
        overtimeHours:
          type: number
          format: double
          description: 月間残業時間（時間）
    MonthlyAttendanceResponse:
      type: object
      required:
        - month
        - totalHours
        - overtimeHours
        - lateCount
        - paidLeaveHours
      properties:
        month:
          type: string
          description: 月（YYYY-MM形式）
          example: "2025-10"
        totalHours:
          type: number
          format: double
          description: 月間総労働時間（時間）
        overtimeHours:
          type: number
          format: double
          description: 月間残業時間（時間）
        lateCount:
          type: integer
          format: int32
          description: 遅刻回数
        paidLeaveHours:
          type: number
          format: double
          description: 有給消化時間（時間）
    StampRequest:
      type: object
      required:
        - stampTime
        - stampType
        - nightWorkFlag
      properties:
        stampTime:
          type: string
          format: date-time
          description: 打刻時刻（ISO形式）
        stampType:
          type: string
          enum:
            - '1'
            - '2'
          description: 打刻種別（1:出勤、2:退勤）
        nightWorkFlag:
          type: string
          enum:
            - '0'
            - '1'
          description: 夜勤フラグ（0:通常、1:夜勤）
    BreakToggleRequest:
      type: object
      required:
        - timestamp
      properties:
        timestamp:
          type: string
          format: date-time
          description: 休憩トグル時刻（ISO 8601形式）
    StampResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: 打刻結果メッセージ
    StampUpdateRequest:
      type: object
      properties:
        inTime:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
          description: 更新後の出勤時刻（HH:mm）
          example: '09:00'
        outTime:
          type: string
          pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
          description: 更新後の退勤時刻（HH:mm）
          example: '18:00'
      anyOf:
        - required:
            - inTime
        - required:
            - outTime
    StampHistoryResponse:
      type: object
      required:
        - selectedYear
        - selectedMonth
        - years
        - months
        - entries
      properties:
        selectedYear:
          type: string
          description: 対象年
        selectedMonth:
          type: string
          description: 対象月
        years:
          type: array
          items:
            type: string
          description: 選択可能な年リスト
        months:
          type: array
          items:
            type: string
          description: 選択可能な月リスト
        entries:
          type: array
          items:
            $ref: '#/components/schemas/StampHistoryEntryResponse'
    StampHistoryEntryResponse:
      type: object
      properties:
        id:
          type: integer
          nullable: true
          description: 打刻履歴ID
        year:
          type: string
          nullable: true
          description: 年
        month:
          type: string
          nullable: true
          description: 月
        day:
          type: string
          nullable: true
          description: 日
        dayOfWeek:
          type: string
          nullable: true
          description: 曜日
        employeeId:
          type: integer
          nullable: true
          description: 従業員ID
        employeeName:
          type: string
          nullable: true
          description: 従業員名
        updateEmployeeName:
          type: string
          nullable: true
          description: 更新者名
        inTime:
          type: string
          nullable: true
          description: 出勤時刻
        outTime:
          type: string
          nullable: true
          description: 退勤時刻
        breakStartTime:
          type: string
          nullable: true
          description: 休憩開始時刻
        breakEndTime:
          type: string
          nullable: true
          description: 休憩終了時刻
        overtimeMinutes:
          type: integer
          format: int32
          nullable: true
          description: 残業時間（分）
        updateDate:
          type: string
          nullable: true
          description: 更新日時
    StampRequestCreateRequest:
      type: object
      required:
        - stampHistoryId
        - reason
      properties:
        stampHistoryId:
          type: integer
          format: int32
          description: 紐づく打刻履歴ID
          example: 101
        requestedInTime:
          type: string
          format: date-time
          description: 希望する出勤時刻
          example: '2025-11-15T08:30:00+09:00'
        requestedOutTime:
          type: string
          format: date-time
          description: 希望する退勤時刻
          example: '2025-11-15T17:30:00+09:00'
        requestedBreakStartTime:
          type: string
          format: date-time
          description: 希望する休憩開始時刻
        requestedBreakEndTime:
          type: string
          format: date-time
          description: 希望する休憩終了時刻
        requestedIsNightShift:
          type: boolean
          description: 夜勤フラグ
        reason:
          type: string
          minLength: 10
          maxLength: 500
          description: 修正理由
    StampRequestCancellationRequest:
      type: object
      required:
        - cancellationReason
      properties:
        cancellationReason:
          type: string
          minLength: 10
          maxLength: 500
          description: 取消理由
    StampRequestApprovalRequest:
      type: object
      properties:
        approvalNote:
          type: string
          maxLength: 500
          description: 承認メモ
    StampRequestRejectionRequest:
      type: object
      required:
        - rejectionReason
      properties:
        rejectionReason:
          type: string
          minLength: 10
          maxLength: 500
          description: 却下理由
    StampRequestBulkApprovalRequest:
      type: object
      required:
        - requestIds
      properties:
        requestIds:
          type: array
          minItems: 1
          maxItems: 50
          items:
            type: integer
            format: int32
          description: 処理対象の申請ID一覧
        approvalNote:
          type: string
          maxLength: 500
          description: 共通承認メモ
    StampRequestBulkRejectionRequest:
      type: object
      required:
        - requestIds
        - rejectionReason
      properties:
        requestIds:
          type: array
          minItems: 1
          maxItems: 50
          items:
            type: integer
            format: int32
          description: 処理対象の申請ID一覧
        rejectionReason:
          type: string
          minLength: 10
          maxLength: 500
          description: 共通却下理由
    StampRequestBulkOperationResponse:
      type: object
      required:
        - successCount
        - failureCount
        - failedRequestIds
      properties:
        successCount:
          type: integer
          format: int32
          description: 成功件数
        failureCount:
          type: integer
          format: int32
          description: 失敗件数
        failedRequestIds:
          type: array
          items:
            type: integer
            format: int32
          description: 失敗した申請ID
    StampRequestResponse:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: リクエストID
        employeeId:
          type: integer
          format: int32
          description: 従業員ID
        employeeName:
          type: string
          description: 従業員氏名
        stampHistoryId:
          type: integer
          format: int32
          description: 紐づく打刻履歴ID
        stampDate:
          type: string
          format: date
          description: 対象日
        originalInTime:
          type: string
          description: オリジナル出勤時刻 (ISO8601)
        originalOutTime:
          type: string
          description: オリジナル退勤時刻 (ISO8601)
        originalBreakStartTime:
          type: string
          description: オリジナル休憩開始
        originalBreakEndTime:
          type: string
          description: オリジナル休憩終了
        originalIsNightShift:
          type: boolean
          description: オリジナル夜勤フラグ
        requestedInTime:
          type: string
          description: 修正後の出勤時刻
        requestedOutTime:
          type: string
          description: 修正後の退勤時刻
        requestedBreakStartTime:
          type: string
          description: 修正後の休憩開始
        requestedBreakEndTime:
          type: string
          description: 修正後の休憩終了
        requestedIsNightShift:
          type: boolean
          description: 修正後の夜勤フラグ
        reason:
          type: string
          description: 申請理由
        status:
          type: string
          description: 申請ステータス
          enum: [NEW, PENDING, APPROVED, REJECTED, CANCELLED]
        approvalNote:
          type: string
          description: 承認メモ
        rejectionReason:
          type: string
          description: 却下理由
        cancellationReason:
          type: string
          description: 取消理由
        approvalEmployeeId:
          type: integer
          format: int32
          description: 承認者ID
        approvalEmployeeName:
          type: string
          description: 承認者氏名
        createdAt:
          type: string
          format: date-time
          description: 作成日時
        updatedAt:
          type: string
          format: date-time
          description: 更新日時
        approvedAt:
          type: string
          format: date-time
          description: 承認日時
        rejectedAt:
          type: string
          format: date-time
          description: 却下日時
        cancelledAt:
          type: string
          format: date-time
          description: 取消日時
        submittedTimestamp:
          type: integer
          format: int64
          description: 提出タイムスタンプ (epoch milliseconds)
        updatedTimestamp:
          type: integer
          format: int64
          description: 最終更新タイムスタンプ (epoch milliseconds)
    StampRequestListResponse:
      type: object
      required:
        - requests
        - totalCount
        - pageNumber
        - pageSize
      properties:
        requests:
          type: array
          items:
            $ref: '#/components/schemas/StampRequestResponse'
        totalCount:
          type: integer
          format: int32
          description: 総件数
        pageNumber:
          type: integer
          format: int32
          description: 現在のページ番号
        pageSize:
          type: integer
          format: int32
          description: ページサイズ
    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: エラーメッセージ
        details:
          type: object
          additionalProperties: true
          description: エラー詳細情報
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: SESSION
  /api/stamp-requests:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを作成
      description: 勤怠履歴に紐づく修正申請を登録します
      operationId: createStampRequest
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestCreateRequest'
      responses:
        '201':
          description: 作成した打刻修正リクエスト
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestResponse'
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/my-requests:
    get:
      tags:
        - Stamp Request Workflow
      summary: 自身の打刻修正リクエスト一覧
      description: ログイン中の従業員の申請一覧を返却します
      operationId: getMyStampRequests
      security:
        - sessionAuth: []
      parameters:
        - name: status
          in: query
          description: フィルタするステータス（ALL で全件）
          required: false
          schema:
            type: string
            enum: [NEW, PENDING, APPROVED, REJECTED, CANCELLED, ALL]
        - name: page
          in: query
          description: ページ番号（0開始）
          required: false
          schema:
            type: integer
            format: int32
            default: 0
            minimum: 0
        - name: size
          in: query
          description: 1ページあたり件数
          required: false
          schema:
            type: integer
            format: int32
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: 申請一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestListResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/pending:
    get:
      tags:
        - Stamp Request Workflow
      summary: 管理者用の保留中リクエスト一覧
      description: 管理者向けにフィルタ済みの打刻修正申請を返却します
      operationId: getPendingStampRequests
      security:
        - sessionAuth: []
      parameters:
        - name: status
          in: query
          description: フィルタするステータス（未指定時はPENDING）
          required: false
          schema:
            type: string
            enum: [NEW, PENDING, APPROVED, REJECTED, CANCELLED]
        - name: search
          in: query
          description: 従業員名や申請理由の部分一致検索
          required: false
          schema:
            type: string
        - name: sort
          in: query
          description: 並び順（recent, oldest, status）
          required: false
          schema:
            type: string
            enum: [recent, oldest, status]
        - name: page
          in: query
          description: ページ番号（0開始）
          required: false
          schema:
            type: integer
            format: int32
            default: 0
            minimum: 0
        - name: size
          in: query
          description: 1ページあたり件数
          required: false
          schema:
            type: integer
            format: int32
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: 管理者向け申請一覧
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestListResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 管理者権限が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/{id}:
    get:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエスト詳細
      description: 指定IDの申請を返却します
      operationId: getStampRequestDetail
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: 申請詳細
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 閲覧権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 申請が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/{id}/approve:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを承認
      operationId: approveStampRequest
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestApprovalRequest'
      responses:
        '204':
          description: 承認完了
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 管理者権限が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 申請が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/{id}/reject:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを却下
      operationId: rejectStampRequest
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestRejectionRequest'
      responses:
        '204':
          description: 却下完了
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 管理者権限が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 申請が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/{id}/cancel:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを取消
      operationId: cancelStampRequest
      security:
        - sessionAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int32
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestCancellationRequest'
      responses:
        '204':
          description: 取消完了
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 取消権限がありません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 申請が見つかりません
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/bulk/approve:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを一括承認
      operationId: bulkApproveStampRequests
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestBulkApprovalRequest'
      responses:
        '200':
          description: 一括承認結果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestBulkOperationResponse'
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 管理者権限が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/stamp-requests/bulk/reject:
    post:
      tags:
        - Stamp Request Workflow
      summary: 打刻修正リクエストを一括却下
      operationId: bulkRejectStampRequests
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StampRequestBulkRejectionRequest'
      responses:
        '200':
          description: 一括却下結果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StampRequestBulkOperationResponse'
        '400':
          description: 入力エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 認証が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 管理者権限が必要です
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
