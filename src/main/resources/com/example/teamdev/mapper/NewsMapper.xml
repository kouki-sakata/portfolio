<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.teamdev.mapper.NewsMapper">

    <resultMap id="newsResultMap" type="com.example.teamdev.entity.News">
        <id property="id" column="id" />
        <result property="newsDate" column="news_date" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="label" column="label" />
        <result property="releaseFlag" column="release_flag" />
        <result property="updateDate" column="update_date" />
    </resultMap>

    <sql id="newsColumns">
        id,
        news_date,
        title,
        content,
        label,
        release_flag,
        update_date
    </sql>

    <select id="getById" resultMap="newsResultMap">
        SELECT
        <include refid="newsColumns" />
        FROM news
        WHERE id = #{id}
    </select>

    <select id="getNewsByReleaseFlagTrue" resultMap="newsResultMap">
        SELECT
        <include refid="newsColumns" />
        FROM news
        WHERE release_flag = TRUE
        ORDER BY news_date DESC
    </select>

    <select id="getNewsByReleaseFlagTrueWithLimit" resultMap="newsResultMap">
        SELECT
        <include refid="newsColumns" />
        FROM news
        WHERE release_flag = TRUE
        ORDER BY news_date DESC
        LIMIT #{limit}
    </select>

    <select id="getNewsOrderByNewsDateDesc" resultMap="newsResultMap">
        SELECT
        <include refid="newsColumns" />
        FROM news
        ORDER BY news_date DESC
    </select>

	<!-- お知らせを挿入 -->
	<insert id="save" parameterType="com.example.teamdev.entity.News" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
		INSERT INTO news (
			news_date,
			title,
			content,
			label,
			release_flag,
			update_date
		) VALUES (
			#{newsDate},
			#{title},
			#{content},
			#{label},
			#{releaseFlag},
			#{updateDate}
		)
	</insert>

	<!-- お知らせを更新 -->
	<update id="upDate" parameterType="com.example.teamdev.entity.News">
		UPDATE news
		SET
			news_date = #{newsDate},
			title = #{title},
			content = #{content},
			label = #{label},
			release_flag = #{releaseFlag},
			update_date = #{updateDate}
		WHERE
			id = #{id}
	</update>

	<!-- 複数のお知らせの公開フラグを一括更新（同じフラグ値） -->
	<update id="bulkUpdateReleaseFlag">
		UPDATE news
		SET
			release_flag = #{releaseFlag},
			update_date = #{updateDate}
		WHERE id IN
		<foreach collection="ids" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
	</update>

	<!-- 複数のお知らせの公開フラグを個別に一括更新（異なるフラグ値） -->
	<update id="bulkUpdateReleaseFlagIndividual">
		<foreach collection="items" item="item" separator=";">
			UPDATE news
			SET
				release_flag = #{item.releaseFlag},
				update_date = #{updateDate}
			WHERE id = #{item.id}
		</foreach>
	</update>

</mapper>
